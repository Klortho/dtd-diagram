"undefined"!=typeof d3&&!function(){DtdDiagram=function(e){var n=this;DtdDiagram.diagrams.push(n),n.opts=e||{},t.then(function(){return n.initialize()}).then(function(){return n.update(n.root)})["catch"](function(t){console.error(t.stack)})},DtdDiagram.diagrams=[],DtdDiagram.auto_start=!0;var t=DtdDiagram.document_ready=new Promise(function(t){document.addEventListener("DOMContentLoaded",t)});t.then(function(){DtdDiagram.auto_start&&0==DtdDiagram.diagrams.length&&new DtdDiagram});var e=20;DtdDiagram.default_options={dtd_json_file:"dtd.json",root_element:null,tag_doc_base:"doc/#p=",tag_doc_url:function(t){var e=t.type,n=t.name;return"other"==e||"element"==e&&n.startsWith("mml:")&&"mml:math"!=n?null:t.diagram.tag_doc_base+("attribute"==e?"attr-":"elem-")+n.replace(":","_")},min_canvas_width:800,min_canvas_height:400,group_separation:1.4,duration:500,event_handler:null,initial_state:"S"},DtdDiagram.prototype.initialize=function(){var t=this;t.last_id=0;var n=t.opts,r=n.container||"dtd-diagram",a=t.container_dom="string"==typeof r?document.getElementById(r):r;if(!a)return void console.error("Something wrong with the specifier for the diagram's DOM element");var i=t.container_d3=d3.select(a),o=a.getAttribute("data-options"),s=o?JSON.parse(o):{};DtdDiagram.extend(t,DtdDiagram.default_options,s,n);var d=t.min_canvas_width,c=t.min_canvas_height;i.style({width:d+e+"px",height:c+e+"px"});var l=t.svg=i.append("svg"),h=l.append("defs");h.append("defs").html('<filter id="dropshadow" height="130%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/><feOffset dx="2" dy="2" result="offsetblur"/><feComponentTransfer>  <feFuncA type="linear" slope=".5"/></feComponentTransfer><feMerge>  <feMergeNode/>  <feMergeNode in="SourceGraphic"/></feMerge></filter>'),h.append("defs").html('<linearGradient id="collapsed-linear-gradient">  <stop style="stop-color:#787878;stop-opacity:0.39215687;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient   xlink:href="#collapsed-linear-gradient"   id="collapsed-fill"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.71138316,-0.67243129,1.0234543,1.0827397,-6.6025303,4.7069303)"   cx="10.3125"   cy="9.359375"   fx="10.3125"   fy="9.359375"   r="7.5" />'),h.append("defs").html('<linearGradient id="expanded-linear-gradient">  <stop style="stop-color:#787878;stop-opacity:0.58823532;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient   xlink:href="#expanded-linear-gradient"   id="expanded-fill"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.60291662,-0.63555279,0.73595623,0.69816422,-4.6918189,8.0214032)"   cx="12.196308"   cy="3.283603"   fx="12.196308"   fy="3.283603"   r="7.5" />'),h.append("defs").html('<linearGradient id="hover-linear-gradient">  <stop style="stop-color:#ffffff;stop-opacity:0.58823532;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient    xlink:href="#hover-linear-gradient"   id="hover-gradient"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.98751557,-0.85565774,1.0673114,1.2317852,-10.470545,8.953672)"   cx="12.196308"   cy="3.283603"   fx="12.196308"   fy="3.283603"   r="7.5" />');var u=t.canvas=new DtdDiagram.Box(-c/2,0,c/2,d);l.attr({xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",width:u.width(),height:u.height()}),t.svg_g=l.append("g").attr({transform:"translate(0, "+-u.top+")"});t.engine=d3.layout.flextree().nodeSize(function(t){return[DtdDiagram.Node.node_height,t.y_size()]}).separation(function(e,n){var r=e.elem_parent==n.elem_parent?1:t.group_separation;return r}),t.diagonal=d3.svg.diagonal().source(function(t,e){var n=t.source;t.target;return{x:n.x+(n.has_content()&&"attribute"==t.target.type?-6:n.has_attributes()&&"attribute"!=t.target.type?6:0),y:n.y+n.width()}}).projection(function(t){return[t.y,t.x]});return new Promise(function(e,n){var r=t.dtd_json_file;d3.json(r,function(a,i){if(a)n(new Error("Error reading DTD file '"+r+"': "+a.statusText));else{t.dtd_json=i;try{t.initialize_root(),e()}catch(o){n(o)}}})})},DtdDiagram.prototype.initialize_root=function(){var t=this,e=t.root_element;if(e&&!t.dtd_json.elements[e])throw t.root=null,new Error("Can't find a declaration for element "+e+" in the DTD.");t.root=DtdDiagram.Node.factory(t,{name:e||t.dtd_json.root,type:"element"},null);t.root.x0=0,t.root.y0=0,t.set_state(t.initial_state||"S")};var n=DtdDiagram.transition_promise=function(t){var e=0;return new Promise(function(n,r){t.empty()?n():t.each(function(){++e}).each("end",function(){--e||n()})})};DtdDiagram.prototype.rebase=function(t){var e,n=this;null==t||"string"==typeof t?(n.root_element=t,n.initialize_root(),e=n.root):(e=n.root=t,e.redraw=!0,e.q=null,delete e._width),n.update(t)},DtdDiagram.prototype.update=function(t){var e=this;e.src_node=t;var r=[],a=e.engine,i=a.nodes(e.root);DtdDiagram.Node.start_update(e,i),e.nodes_enter.each(function(t){t.draw_enter(this)}),e.nodes_update.each(function(t){r.push(t.transition_update())}),e.nodes_exit.each(function(t){r.push(t.transition_exit())});var o=a.links(i),s=e.svg_g.selectAll("path.link").data(o,function(t){return t.target.id}),d={x:t.x0,y:t.y0,width:function(){return 0},has_content:function(){return!1},has_attributes:function(){return!1}},c=e.diagonal;s.enter().insert("path","g").attr("class","link").attr("d",function(t){return c({source:d,target:d})});var l=e.duration;r.push(n(s.transition().duration(l).attr("d",c))),r.push(n(s.exit().transition().duration(l).attr("d",function(t){return c({source:d,target:d})}).remove()));var h=DtdDiagram.Canvas;r.push(DtdDiagram.Canvas.scroll_resize(e)),e.canvas=e.new_canvas.copy(),Promise.all(r).then(function(t){h.finish(e)},function(t){console.error("Problem during transistions: "+t.stack)}),i.forEach(function(t){t.x0=t.x,t.y0=t.y})},DtdDiagram.prototype.state=function(){var t=this.root.state();return DtdDiagram.Compressor.compress(t)},DtdDiagram.prototype.set_state=function(t){var e=DtdDiagram.Compressor.decompress(t);this.root.set_state(e)},DtdDiagram.extend=function(){for(var t=arguments[0],e=1;e<arguments.length;++e){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t}}(),function(){var t=DtdDiagram.Box=function(t,e,n,r){this.top=t,this.left=e,this.bottom=n,this.right=r};DtdDiagram.extend(t.prototype,{log:function(t){console.log(t+": {top: "+this.top+", left: "+this.left+", bottom: "+this.bottom+", right: "+this.right+"}")},copy:function(){return new t(this.top,this.left,this.bottom,this.right)},width:function(){return this.right-this.left},height:function(){return this.bottom-this.top},vcenter:function(){return(this.top+this.bottom)/2},vmove:function(t){return this.top+=t,this.bottom+=t,this},hmove:function(t){return this.left+=t,this.right+=t,this}})}(),function(){function t(e,n){var r=n.get_children().reduce(t,e),a=n.extents();return new DtdDiagram.Box(d3.min([r.top,a.top]),d3.min([r.left,a.left]),d3.max([r.bottom,a.bottom]),d3.max([r.right,a.right]))}var e=DtdDiagram.Node={node_height:32,node_box_height:25,diagonal_width:20,node_text_margin:10},n={};e.register=function(t,e){n[t]=e},e.factory=function(t,e,r){if(!e.type)return console.error("Invalid DTD, every node specifier must have a type"),null;var a=n[e.type];if(!a)return console.error("Invalid DTD, node type not recognized: "+e.type),null;var i=new a;i.diagram=t,i.spec=e,i.elem_parent=r,i.children=[];for(var o in e)"children"!=o&&(i[o]=e[o]);return i.initialize(),i},e.path=function(){for(var t="",e=0;e<arguments.length;++e)t+=arguments[e]+" ";return t},e.la=function(t,e){return"l "+t*Math.cos(e)+","+t*Math.sin(e)+" "},e.arc=function(t,e,n,r){return"undefined"==typeof r&&(r=0),"a "+t+","+t+" 0,"+r+",1 "+e+","+n+" "},e.start_update=function(t,e){var n=t.src_node,r=t.nodes_update=t.svg_g.selectAll("g.node").data(e,function(e){return e.id||(e.id=++t.last_id)}),a=t.nodes_enter=r.enter().append("g").attr({"class":function(t){return"node "+t.type},filter:"url(#dropshadow)",transform:"translate("+n.y0+","+n.x0+") scale(0.001, 0.001)"});a.each(function(t){t.gs=d3.select(this)}),t.nodes_exit=r.exit()},e.methods={initialize:function(){},has_content:function(){return!1},has_attributes:function(){return!1},has_q:function(){return!1},q_width:function(){return 0},get_children:function(){return this.children||[]},get_content:function(){return[]},element_list:function(){return this.get_children().reduce(function(t,e){return t.concat(e.element_list())},"element"==this.type?[this]:[])},state:function(){return""+this.state_children()},state_children:function(){return this.get_children().reduce(function(t,e){return t+e.state()},"")},set_state:function(t,e){return e>=t.length?e:this.set_state_children(t,e)},set_state_children:function(t,e){for(var n=this.get_children(),r=0;r<n.length&&e<t.length;++r)e=n[r].set_state(t,e);return e},extents:function(){this.diagram;return new DtdDiagram.Box(this.x-e.node_box_height/2,this.y,this.x+e.node_box_height/2,this.y+this.width())},tree_extents:function(){return this.get_children().reduce(t,this.extents())},y_size:function(){return this.width()+e.diagonal_width},width:function(){return"_width"in this||(this._width=this.compute_width()),this._width},transition_update:function(){var t=this;return DtdDiagram.transition_promise(t.gs.transition().duration(t.diagram.duration).attr("transform","translate("+t.y+","+t.x+") scale(1, 1)"))},transition_exit:function(){var t=this;return src_node=t.diagram.src_node,DtdDiagram.transition_promise(t.gs.transition().duration(t.diagram.duration).attr("transform",function(t){return"translate("+src_node.y+","+src_node.x+") scale(0.001, 0.001)"}).remove())}}}(),function(){var t=DtdDiagram.Node;DtdDiagram.HasLabelNode={draw_enter_label:function(){var e=this,n=e.diagram,r=n.tag_doc_url(e),a=e.gs;r&&(a=e.gs.append("a").attr("xlink:href",r)),a.append("text").attr({id:e.id,"class":"label",x:t.node_text_margin+e.q_width(),y:0,"text-anchor":"baseline","alignment-baseline":"middle"}).text(e.name)},label_width:function(){var e=this,n=e.diagram,r=e.name;"label_width_cache"in n||(n.label_width_cache={});var a=n.label_width_cache;if(!(r in a)){var i=n.svg_g.append("text").attr({id:"temporary-label","class":"label",x:0,y:0}).text(r).style("fill-opacity",0);a[r]=2*t.node_text_margin+document.getElementById("temporary-label").getBBox().width,i.remove()}return a[r]},compute_width:function(){return this.label_width()}}}(),function(){var t=DtdDiagram.Node,e=t.path,n=t.arc,r=t.la,a=(t.arca,12),i=4,o=e("M",-i,0,"l",2*i,0,"M",0,-i,"l",0,2*i),s=4.5,d=function(){for(var t=-Math.PI/2,n="",a=0;5>a;++a)n+=e("M",0,0)+r(s,t+2*a*Math.PI/5);return n}(),c=2.3,l=Math.PI/3,h=-c*Math.sin(l),u=-c*(1+Math.cos(l)),p=2,f=e("M",h,u)+n(c,-h,-u,1)+e("l",0,p)+"m 0,3 "+n(.5,1e-4,0,1)+"z";DtdDiagram.HasQNode={initialize:function(){"q"in this||(this.q=null)},has_q:function(){return!!this.q},q_width:function(){return this.has_q()?a:0},draw_enter_q:function(t){var e=this;if(e.has_q()){var n=e.q,r="*"==n?d:"+"==n?o:f;e.gs.append("g").attr("transform","translate("+t+",0)").append("path").attr({"class":"q",d:r})}}}}(),function(){var t=DtdDiagram.Node,e=DtdDiagram.HasLabelNode,n=DtdDiagram.HasQNode,r=15,a=DtdDiagram.ElementNode=function(){};t.register("element",a),a.content_click_handler=function(t){t.toggle_content(),t.diagram.update(t),"function"==typeof t.diagram.event_handler&&t.diagram.event_handler("content-click",t)},a.attributes_click_handler=function(t){t.toggle_attributes(),t.diagram.update(t),"function"==typeof t.diagram.event_handler&&t.diagram.event_handler("attributes-click",t)},a.rebase_click_handler=function(t){t.content_expanded||t.attributes_expanded||(t.expand_content(),t.expand_attributes()),t.diagram.rebase(t),"function"==typeof t.diagram.event_handler&&t.diagram.event_handler("rebase",t)},DtdDiagram.extend(a.prototype,t.methods,e,n,{initialize:function(){var e=this,r=e.diagram;n.initialize.call(e),e.content=null,e.content_expanded=!1,e.attributes_expanded=!1;var a=e.declaration=r.dtd_json.elements[e.name];"object"!=typeof a&&(console.error("Can't find a declaration for element "+e.name+" in the DTD."),a=e.declaration=null);var i=e.attributes=[];a&&a.attributes&&a.attributes.forEach(function(n){i.push(t.factory(r,n,e))})},init_content:function(){var e=this,n=e.diagram,r=e.declaration,a=e.content=[];r&&r.content&&r.content.children&&r.content.children.forEach(function(r){a.push(t.factory(n,r,e))})},get_content:function(){return null==this.content&&this.init_content(),this.content},has_content:function(){return null==this.content&&this.init_content(),this.content.length>0},has_attributes:function(){return this.attributes.length>0},toggle_content:function(){this.content_expanded=!this.content_expanded,this.set_children()},collapse_content:function(){this.content_expanded=!1,this.set_children()},expand_content:function(){this.content_expanded=!0,this.set_children()},toggle_attributes:function(){this.attributes_expanded=!this.attributes_expanded,this.set_children()},collapse_attributes:function(){this.attributes_expanded=!1,this.set_children()},expand_attributes:function(){this.attributes_expanded=!0,this.set_children()},expand:function(){this.content_expanded=this.attributes_expanded=!0,this.set_children()},set_children:function(){var t=this.content_expanded,e=this.attributes_expanded;t||e?!t&&e?this.children=this.attributes:t&&!e?this.children=this.get_content():this.children=this.attributes.concat(this.get_content()):this.children=[],this.gs&&(this.gs.select(".cb rect").attr("class",t?"expanded":"collapsed"),this.gs.select(".ab rect").attr("class",e?"expanded":"collapsed"))},compute_width:function(){return this.q_width()+(this.has_content()||this.has_attributes()?r:0)+this.label_width()},draw_enter:function(){var e=this,n=(e.diagram,e.gs),r=t.node_box_height;n.append("rect").attr({"data-id":e.id,"class":"box",width:e.width(),height:r,y:-r/2,rx:6,ry:6}),e.draw_enter_label(),e.draw_enter_q(t.node_text_margin),e.has_content()&&e.draw_button("cb",e.has_attributes()?r/4-.5:0,a.content_click_handler),e.has_attributes()&&e.draw_button("ab",e.has_content()?-r/4+.5:0,a.attributes_click_handler);var i=n.append("g").attr({"class":"button rebase",transform:"translate(2, -16)"});i.append("rect").attr({"class":"collapsed",width:10,height:5,x:0,y:0,rx:2.5,ry:2.5,transform:"translate(0,5)"}).on("click",a.rebase_click_handler)},draw_button:function(e,n,a){var i=this,o=(i.diagram,i.gs),s=t.node_box_height,d=i.width(),c=o.append("g").attr({"class":"button "+e,transform:"translate("+(d-r-2)+","+(n+s/4-16.2)+")"}),l="cb"==e?i.content_expanded:i.attributes_expanded,h=l?"expanded":"collapsed";c.append("rect").attr({"class":h,width:15,height:10,x:0,y:0,rx:5,ry:5,transform:"translate(0,5)"}).on("click",a),"cb"==e?c.append("g").attr("transform","translate(-0.56249982,0)").attr("pointer-events","none").html('<g transform="matrix(0.93056698,0,0,1.2232143,-0.79346636,-1.1542969)">  <path d="m 2.5245,8.71325 6.076,-2.842 0,1.022 -4.97,2.268 4.956,2.268 0.014,1.022 -6.076,-2.842 0,-0.896" /></g><g transform="matrix(-0.93056698,0,0,1.2232143,16.918466,-1.1542969)">  <path d="m 2.5245,8.71325 6.076,-2.842 0,1.022 -4.97,2.268 4.956,2.268 0.014,1.022 -6.076,-2.842 0,-0.896"/></g>'):c.append("path").attr("pointer-events","none").attr("d","m 8.136125,11.77975 c -5.6e-6,-0.07466 0.00466,-0.139997 0.014,-0.196 -0.3546719,0.550669 -0.9006713,0.826002 -1.638,0.826 -0.4480035,2e-6 -0.8120031,-0.149331 -1.092,-0.448 -0.2706692,-0.307997 -0.4060024,-0.704663 -0.406,-1.19 -2.4e-6,-0.8493287 0.3079973,-1.5959946 0.924,-2.24 0.615996,-0.6533266 1.3299953,-0.979993 2.142,-0.98 0.186661,7e-6 0.3919941,0.028007 0.616,0.084 l 0.28,0.07 c 0.037327,0.018674 0.083994,0.028007 0.14,0.028 0.04666,6.9e-6 0.1259933,-0.023326 0.238,-0.07 0.1493264,-0.065326 0.2566596,-0.097993 0.322,-0.098 0.1399928,7e-6 0.2099927,0.060674 0.21,0.182 -7.3e-6,0.028007 -0.00934,0.07934 -0.028,0.154 l -0.07,0.266 -0.798,2.982 c -0.028006,0.112003 -0.042006,0.20067 -0.042,0.266 -6.4e-6,0.168003 0.08866,0.252003 0.266,0.252 0.3453264,3e-6 0.667326,-0.223997 0.966,-0.672 0.419992,-0.625329 0.629992,-1.3486617 0.63,-2.17 -8e-6,-0.7746601 -0.256675,-1.4186595 -0.77,-1.932 -0.504007,-0.5133251 -1.1433397,-0.7699915 -1.918,-0.77 -1.0920045,8.5e-6 -2.0440035,0.4386747 -2.856,1.316 -0.8026686,0.8680063 -1.2040015,1.8900053 -1.204,3.066 -1.5e-6,0.91467 0.2939982,1.680002 0.882,2.296 0.587997,0.606668 1.3253296,0.910001 2.212,0.91 0.5226616,10e-7 0.9519945,-0.06067 1.288,-0.182 0.3453271,-0.130665 0.77466,-0.382665 1.288,-0.756 0.1866593,-0.139998 0.340659,-0.209998 0.462,-0.21 0.177326,2e-6 0.265992,0.084 0.266,0.252 -8e-6,0.177335 -0.121341,0.359335 -0.364,0.546 -0.9240066,0.728001 -1.9413389,1.092 -3.052,1.092 -1.1293367,0 -2.0720024,-0.373333 -2.828,-1.12 -0.7466676,-0.755998 -1.1200005,-1.698664 -1.12,-2.828 -5e-7,-1.3626612 0.503999,-2.5479934 1.512,-3.556 1.0173303,-1.0173247 2.2166624,-1.5259908 3.598,-1.526 1.0453267,9.2e-6 1.894659,0.3080089 2.548,0.924 0.662658,0.6160076 0.993991,1.4186735 0.994,2.408 -9e-6,1.1106714 -0.406009,2.081337 -1.218,2.912 -0.494674,0.504002 -1.0126736,0.756002 -1.554,0.756 -0.2426728,2e-6 -0.4433393,-0.06066 -0.602,-0.182 -0.1586723,-0.121331 -0.2380056,-0.275331 -0.238,-0.462 m 0.294,-1.904 0.378,-1.4 c -0.2800059,-0.1399937 -0.5506723,-0.2099937 -0.812,-0.21 -0.5413382,6.3e-6 -1.0173377,0.2380061 -1.428,0.714 -0.4013369,0.4760051 -0.6020034,1.031338 -0.602,1.666 -3.4e-6,0.644003 0.2799963,0.966003 0.84,0.966 0.7746617,3e-6 1.3159945,-0.578663 1.624,-1.736")},transition_update:function(){this.redraw&&(this.gs.html(""),this.draw_enter(),this.redraw=!1),t.methods.transition_update.call(this)},state:function(){return(this.attributes_expanded?"1":"0")+(this.content_expanded?"1":"0")+this.state_children()},set_state:function(t,e){return"undefined"==typeof e&&(e=0),0>e||e>=t.length?e:(console.log("setting state of "+this.name+" to "+t.substr(e,2)),this.attributes_expanded="1"==t.charAt(e),this.content_expanded="1"==t.charAt(e+1),this.set_children(),this.set_state_children(t,e+2))}})}(),function(){var t=DtdDiagram.Node,e=21,n=DtdDiagram.AttributeNode=function(){};t.register("attribute",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasLabelNode,{draw_enter:function(){var t=this;t.gs.append("ellipse").attr({"data-id":t.id,"class":"box",cx:t.width()/2,cy:0,rx:t.width()/2,ry:e/2}),t.draw_enter_label()}})}(),function(){DtdDiagram.ChoiceSeqNode={initialize:function(){var t=this;DtdDiagram.HasQNode.initialize.call(t),(t.spec.children||[]).forEach(function(e){t.children.push(DtdDiagram.Node.factory(t.diagram,e,t.elem_parent))})},get_content:function(){return this.get_children()},draw_enter:function(){this.gs.append("path").attr({"class":this.type,d:this.path()}),this.draw_enter_q(this.width()/2)}}}(),function(){var t=DtdDiagram.Node,e=20,n=DtdDiagram.ChoiceNode=function(){};t.register("choice",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasQNode,DtdDiagram.ChoiceSeqNode,{width:function(){return e},path:function(){return t.path("M",0,0,"L",e/2,-e/2,"L",e,0,"L",e/2,e/2,"z")}})}(),function(){var t=DtdDiagram.Node,e=13,n=DtdDiagram.SeqNode=function(){};t.register("seq",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasQNode,DtdDiagram.ChoiceSeqNode,{width:function(){return e},path:function(){var n=t.path;return arc=t.arc,s=8,n("M",0,s/2,"v",-s)+arc(e/2,e,0)+n("v",s)+arc(e/2,-e,0)+"z"}})}(),function(){var t=DtdDiagram.Node,e=18,n=DtdDiagram.OtherNode=function(){};t.register("other",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasLabelNode,{draw_enter:function(){var t=this;t.gs.append("g").attr("transform","skewX(-15)").append("rect").attr({"data-id":t.id,"class":"box",width:t.width(),height:e,y:-e/2,rx:3,ry:3}),t.draw_enter_label()}})}(),function(){function t(t){var e=t.container_dom,n=t.new_canvas,r=n.width(),a=n.height();t.svg.style({width:r,height:a}),e.style.display="none",e.style.display="block"}function e(t,e){return function(){var n=d3.interpolateNumber(this.scrollTop,t),r=d3.interpolateNumber(this.scrollLeft,e);return function(t){this.scrollTop=n(t),this.scrollLeft=r(t)}}}function n(n){var r=n.new_viewport,a=n.container_dom;return n.embiggenning&&t(n),new_scroll_top=r.top-n.new_canvas.top,new_scroll_left=r.left,new Promise(function(t,r){a.scrollTop!=new_scroll_top||a.scrollLeft!=new_scroll_left?n.container_d3.transition().duration(n.duration).tween("uniquetweenname1",e(new_scroll_top,new_scroll_left)).each("end",function(){t("done scroll_canvas to "+new_scroll_top+", "+new_scroll_left)}):t("scroll_canvas: nothing to do")})}var r=DtdDiagram.Canvas={dropshadow_margin:5};r.scroll_resize=function(t){return a(t),Promise.all([n(t),new Promise(function(e,n){t.svg_g.transition().duration(t.duration).attr({transform:"translate(0, "+-t.new_canvas.top+")"}).each("end",function(){e("done transitioning svg coordinates")})})])},r.finish=function(e){e.embiggenning||t(e)};var a=function(t){var e=DtdDiagram.Box,n=t.root,a=t.min_canvas_height,i=t.min_canvas_width,o=t.src_node,s=t.canvas,d=t.new_drawing=n.tree_extents();d.bottom+=r.dropshadow_margin;var c=d.height()>=a?d.top:(d.bottom+d.top-a)/2,l=d.height()>=a?d.bottom:c+a,h=t.new_canvas=new e(c,d.left,l,d.width()>=i?d.right:d.left+i),u=o.extents(),p=o.tree_extents(),f=p.copy();if(f.width()>i&&(f.right=f.left+i),f.height()>a){var _=f.vcenter(),g=_-a/2,m=_+a/2,v=u.top<g?u.top-g:u.bottom>m?u.bottom-m:0;f.top=g+v,f.bottom=m+v}var D=t.container_dom,b=D.scrollTop,w=D.scrollLeft,x=t.viewport=new e(b+s.top,w,b+s.top+a,w+i),y=t.new_viewport=x.copy();y.vmove(f.top<y.top?f.top-y.top:f.bottom>y.bottom?f.bottom-y.bottom:0),y.vmove(h.top>y.top?h.top-y.top:h.bottom<y.bottom?h.bottom-y.bottom:0),y.hmove(f.left<y.left?f.left-y.left:f.right>y.right?f.right-y.right:0),y.hmove(h.left>y.left?h.left-y.left:h.right<y.right?h.right-y.right:0),t.embiggenning=h.width()>s.width()||h.height()>s.height()}}(),"undefined"==typeof DtdDiagram&&(DtdDiagram={}),function(){var t=!1,e=t&&"undefined"!=typeof window&&window.console?console.log.bind(window.console):function(){},n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.",r=DtdDiagram.Compressor={compress:function(t){e("compressing original string: "+t);var n=r.rll_compress(t);e("rll_compressed: "+n);var a=r.binstr_to_base64(n);return e("base64: "+a),e("compression ratio: "+t.length/a.length),a},binstr_to_base64:function(t){for(var e=r.cap(t),a=e.length,i="",o=0;a>o;o+=6){var s=parseInt(e.substr(o,6),2);i+=n.charAt(s)}return i},cap:function(t){var n=t+"1"+"0".repeat(5-t.length%6);return e("capped: "+n),n},int_to_binary:function(t,e){var n=t.toString(2);return"0".repeat(e-n.length)+n},rll_compress:function(t){var e=t.indexOf("1"),n=-1==e?"":(0==e?"00":4>=e?"01"+r.int_to_binary(e-1,2):20>=e?"10"+r.int_to_binary(e-5,4):"11"+r.int_to_binary(e-21,10))+r.rll_compress(t.substr(e+1));return n},decompress:function(t){e("decompressing: "+t);var n=r.base64_to_binstr(t);e("rll_compressed: "+n);var a=r.rll_decompress(n);return e("final binary string: "+a),a},base64_to_binstr:function(t){var r=t.split("").reduce(function(t,e){var r=n.indexOf(e).toString(2);return r="0".repeat(6-r.length)+r,t+r},"");e("  capped: "+r);var a=r.substr(0,r.lastIndexOf("1"));return e("  uncapped: "+a),a},rll_decompress:function(t){for(var e="";t.length>0;){var n,r=t.substr(0,2);"00"==r?(n=0,t=t.substr(2)):"01"==r?(n=parseInt(t.substr(2,2),2)+1,t=t.substr(4)):"10"==r?(n=parseInt(t.substr(2,4),2)+5,t=t.substr(6)):(n=parseInt(t.substr(2,10),2)+21,t=t.substr(12)),e+="0".repeat(n)+"1"}return e}};"undefined"!=typeof module&&(module.exports=r)}();
//# sourceMappingURL=dtd-diagram.min.js.map
