"undefined"!=typeof d3&&!function(){DtdDiagram=function(e){var n=this;DtdDiagram.diagrams.push(n),n.opts=e||{},t.then(function(){return n.initialize()}).then(function(){return n.update(n.root)})["catch"](function(t){console.error(t.stack)})},DtdDiagram.diagrams=[],DtdDiagram.auto_start=!0;var t=DtdDiagram.document_ready=new Promise(function(t){document.addEventListener("DOMContentLoaded",t)});t.then(function(){DtdDiagram.auto_start&&0==DtdDiagram.diagrams.length&&new DtdDiagram});var e=20;DtdDiagram.default_options={dtd_json_file:"dtd.json",root_element:null,tag_doc_base:"doc/#p=",tag_doc_url:function(t){var e=t.type,n=t.name;return"other"==e||"element"==e&&n.startsWith("mml:")&&"mml:math"!=n?null:t.diagram.tag_doc_base+("attribute"==e?"attr-":"elem-")+n.replace(":","_")},min_canvas_width:800,min_canvas_height:400,group_separation:1.4,duration:500,rebase_handler:null},DtdDiagram.prototype.initialize=function(){var t=this;t.last_id=0;var n=t.opts,a=n.container||"dtd-diagram",r=t.container_dom="string"==typeof a?document.getElementById(a):a;if(!r)return void console.error("Something wrong with the specifier for the diagram's DOM element");var i=t.container_d3=d3.select(r),o=r.getAttribute("data-options"),d=o?JSON.parse(o):{};DtdDiagram.extend(t,DtdDiagram.default_options,d,n);var s=t.min_canvas_width,c=t.min_canvas_height;i.style({width:s+e+"px",height:c+e+"px"});var l=t.svg=i.append("svg"),h=l.append("defs");h.append("defs").html('<filter id="dropshadow" height="130%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/><feOffset dx="2" dy="2" result="offsetblur"/><feComponentTransfer>  <feFuncA type="linear" slope=".5"/></feComponentTransfer><feMerge>  <feMergeNode/>  <feMergeNode in="SourceGraphic"/></feMerge></filter>'),h.append("defs").html('<linearGradient id="collapsed-linear-gradient">  <stop style="stop-color:#787878;stop-opacity:0.39215687;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient   xlink:href="#collapsed-linear-gradient"   id="collapsed-fill"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.71138316,-0.67243129,1.0234543,1.0827397,-6.6025303,4.7069303)"   cx="10.3125"   cy="9.359375"   fx="10.3125"   fy="9.359375"   r="7.5" />'),h.append("defs").html('<linearGradient id="expanded-linear-gradient">  <stop style="stop-color:#787878;stop-opacity:0.58823532;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient   xlink:href="#expanded-linear-gradient"   id="expanded-fill"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.60291662,-0.63555279,0.73595623,0.69816422,-4.6918189,8.0214032)"   cx="12.196308"   cy="3.283603"   fx="12.196308"   fy="3.283603"   r="7.5" />'),h.append("defs").html('<linearGradient id="hover-linear-gradient">  <stop style="stop-color:#ffffff;stop-opacity:0.58823532;"        offset="0"/>  <stop style="stop-color:#000000;stop-opacity:0;"        offset="1"/></linearGradient><radialGradient    xlink:href="#hover-linear-gradient"   id="hover-gradient"   gradientUnits="userSpaceOnUse"   gradientTransform="matrix(0.98751557,-0.85565774,1.0673114,1.2317852,-10.470545,8.953672)"   cx="12.196308"   cy="3.283603"   fx="12.196308"   fy="3.283603"   r="7.5" />');var u=t.canvas=new DtdDiagram.Box(-c/2,0,c/2,s);l.attr({xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",width:u.width(),height:u.height()}),t.svg_g=l.append("g").attr({transform:"translate(0, "+-u.top+")"});t.engine=d3.layout.flextree().nodeSize(function(t){return[DtdDiagram.Node.node_height,t.y_size()]}).separation(function(e,n){var a=e.elem_parent==n.elem_parent?1:t.group_separation;return a}),t.diagonal=d3.svg.diagonal().source(function(t,e){var n=t.source;t.target;return{x:n.x+(n.has_content()&&"attribute"==t.target.type?-6:n.has_attributes()&&"attribute"!=t.target.type?6:0),y:n.y+n.width()}}).projection(function(t){return[t.y,t.x]});return new Promise(function(e,n){var a=t.dtd_json_file;d3.json(a,function(r,i){if(r)n(new Error("Error reading DTD file '"+a+"': "+r.statusText));else{t.dtd_json=i;try{t.initialize_root(),e()}catch(o){n(o)}}})})},DtdDiagram.prototype.initialize_root=function(){var t=this,e=t.root_element;if(e&&!t.dtd_json.elements[e])throw t.root=null,new Error("Can't find a declaration for element "+e+" in the DTD.");var n=t.root=DtdDiagram.Node.factory(t,{name:e||t.dtd_json.root,type:"element"},null);t.root.x0=0,t.root.y0=0,n.expand()};var n=DtdDiagram.transition_promise=function(t){var e=0;return new Promise(function(n,a){t.empty()?n():t.each(function(){++e}).each("end",function(){--e||n()})})};DtdDiagram.prototype.rebase=function(t){var e,n=this;null==t||"string"==typeof t?(n.root_element=t,n.initialize_root(),e=n.root):(e=n.root=t,e.redraw=!0,e.q=null,delete e._width),n.update(t)},DtdDiagram.prototype.update=function(t){var e=this;e.src_node=t;var a=[],r=e.engine,i=r.nodes(e.root);DtdDiagram.Node.start_update(e,i),e.nodes_enter.each(function(t){t.draw_enter(this)}),e.nodes_update.each(function(t){a.push(t.transition_update())}),e.nodes_exit.each(function(t){a.push(t.transition_exit())});var o=r.links(i),d=e.svg_g.selectAll("path.link").data(o,function(t){return t.target.id}),s={x:t.x0,y:t.y0,width:function(){return 0},has_content:function(){return!1},has_attributes:function(){return!1}},c=e.diagonal;d.enter().insert("path","g").attr("class","link").attr("d",function(t){return c({source:s,target:s})});var l=e.duration;a.push(n(d.transition().duration(l).attr("d",c))),a.push(n(d.exit().transition().duration(l).attr("d",function(t){return c({source:s,target:s})}).remove()));var h=DtdDiagram.Canvas;a.push(DtdDiagram.Canvas.scroll_resize(e)),e.canvas=e.new_canvas.copy(),Promise.all(a).then(function(t){h.finish(e)},function(t){console.error("Problem during transistions: "+t.stack)}),i.forEach(function(t){t.x0=t.x,t.y0=t.y})},DtdDiagram.extend=function(){for(var t=arguments[0],e=1;e<arguments.length;++e){var n=arguments[e];for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])}return t}}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Box=function(t,e,n,a){this.top=t,this.left=e,this.bottom=n,this.right=a};DtdDiagram.extend(t.prototype,{log:function(t){console.log(t+": {top: "+this.top+", left: "+this.left+", bottom: "+this.bottom+", right: "+this.right+"}")},copy:function(){return new t(this.top,this.left,this.bottom,this.right)},width:function(){return this.right-this.left},height:function(){return this.bottom-this.top},vcenter:function(){return(this.top+this.bottom)/2},vmove:function(t){return this.top+=t,this.bottom+=t,this},hmove:function(t){return this.left+=t,this.right+=t,this}})}(),"undefined"!=typeof DtdDiagram&&!function(){function t(t,e){for(var n=0;n<e.length;++n)t.push(e[n])}function e(t,n){var a=(n.children||[]).reduce(e,t),r=n.extents();return new DtdDiagram.Box(d3.min([a.top,r.top]),d3.min([a.left,r.left]),d3.max([a.bottom,r.bottom]),d3.max([a.right,r.right]))}var n=DtdDiagram.Node={node_height:32,node_box_height:25,diagonal_width:20,node_text_margin:10},a={};n.register=function(t,e){a[t]=e},n.factory=function(t,e,n){if(!e.type)return console.error("Invalid DTD, every node specifier must have a type"),null;var r=a[e.type];if(!r)return console.error("Invalid DTD, node type not recognized: "+e.type),null;var i=new r;i.diagram=t,i.spec=e,i.elem_parent=n,i.children=[];for(var o in e)"children"!=o&&(i[o]=e[o]);return i.initialize(),i},n.path=function(){for(var t="",e=0;e<arguments.length;++e)t+=arguments[e]+" ";return t},n.la=function(t,e){return"l "+t*Math.cos(e)+","+t*Math.sin(e)+" "},n.arc=function(t,e,n,a){return"undefined"==typeof a&&(a=0),"a "+t+","+t+" 0,"+a+",1 "+e+","+n+" "},n.start_update=function(t,e){var n=t.src_node,a=t.nodes_update=t.svg_g.selectAll("g.node").data(e,function(e){return e.id||(e.id=++t.last_id)}),r=t.nodes_enter=a.enter().append("g").attr({"class":function(t){return"node "+t.type},filter:"url(#dropshadow)",transform:"translate("+n.y0+","+n.x0+") scale(0.001, 0.001)"});r.each(function(t){t.gs=d3.select(this)}),t.nodes_exit=a.exit()},n.methods={initialize:function(){},has_content:function(){return!1},has_attributes:function(){return!1},has_q:function(){return!1},q_width:function(){return 0},get_content:function(){return[]},elem_descendants:function(){var e=[];return this.get_content().forEach(function(n){"element"==n.type?e.push(n):("choice"==n.type||"seq"==n.type)&&t(e,n.elem_descendants())}),e},extents:function(){this.diagram;return new DtdDiagram.Box(this.x-n.node_box_height/2,this.y,this.x+n.node_box_height/2,this.y+this.width())},tree_extents:function(){return(this.children||[]).reduce(e,this.extents())},y_size:function(){return this.width()+n.diagonal_width},width:function(){return"_width"in this||(this._width=this.compute_width()),this._width},transition_update:function(){var t=this;return DtdDiagram.transition_promise(t.gs.transition().duration(t.diagram.duration).attr("transform","translate("+t.y+","+t.x+") scale(1, 1)"))},transition_exit:function(){var t=this;return src_node=t.diagram.src_node,DtdDiagram.transition_promise(t.gs.transition().duration(t.diagram.duration).attr("transform",function(t){return"translate("+src_node.y+","+src_node.x+") scale(0.001, 0.001)"}).remove())}}}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node;DtdDiagram.HasLabelNode={draw_enter_label:function(){var e=this,n=e.diagram,a=n.tag_doc_url(e),r=e.gs;a&&(r=e.gs.append("a").attr("xlink:href",a)),r.append("text").attr({id:e.id,"class":"label",x:t.node_text_margin+e.q_width(),y:0,"text-anchor":"baseline","alignment-baseline":"middle"}).text(e.name)},label_width:function(){var e=this,n=e.diagram,a=e.name;"label_width_cache"in n||(n.label_width_cache={});var r=n.label_width_cache;if(!(a in r)){var i=n.svg_g.append("text").attr({id:"temporary-label","class":"label",x:0,y:0}).text(a).style("fill-opacity",0);r[a]=2*t.node_text_margin+document.getElementById("temporary-label").getBBox().width,i.remove()}return r[a]},compute_width:function(){return this.label_width()}}}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=t.path,n=t.arc,a=t.la,r=(t.arca,12),i=4,o=e("M",-i,0,"l",2*i,0,"M",0,-i,"l",0,2*i),d=4.5,s=function(){for(var t=-Math.PI/2,n="",r=0;5>r;++r)n+=e("M",0,0)+a(d,t+2*r*Math.PI/5);return n}(),c=2.3,l=Math.PI/3,h=-c*Math.sin(l),u=-c*(1+Math.cos(l)),f=2,p=e("M",h,u)+n(c,-h,-u,1)+e("l",0,f)+"m 0,3 "+n(.5,1e-4,0,1)+"z";DtdDiagram.HasQNode={initialize:function(){"q"in this||(this.q=null)},has_q:function(){return!!this.q},q_width:function(){return this.has_q()?r:0},draw_enter_q:function(t){var e=this;if(e.has_q()){var n=e.q,a="*"==n?s:"+"==n?o:p;e.gs.append("g").attr("transform","translate("+t+",0)").append("path").attr({"class":"q",d:a})}}}}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=DtdDiagram.HasLabelNode,n=DtdDiagram.HasQNode,a=15,r=DtdDiagram.ElementNode=function(){};t.register("element",r),r.content_click_handler=function(t){t.toggle_content(),t.diagram.update(t)},r.attributes_click_handler=function(t){t.toggle_attributes(),t.diagram.update(t)},r.rebase_click_handler=function(t){"function"==typeof t.diagram.rebase_handler&&t.diagram.rebase_handler(t),t.content_expanded||t.attributes_expanded||(t.expand_content(),t.expand_attributes()),t.diagram.rebase(t)},DtdDiagram.extend(r.prototype,t.methods,e,n,{initialize:function(){var e=this,a=e.diagram;n.initialize.call(e),e.content=null,e.content_expanded=!1,e.attributes_expanded=!1;var r=e.declaration=a.dtd_json.elements[e.name];"object"!=typeof r&&(console.error("Can't find a declaration for element "+e.name+" in the DTD."),r=e.declaration=null);var i=e.attributes=[];r&&r.attributes&&r.attributes.forEach(function(n){i.push(t.factory(a,n,e))})},init_content:function(){var e=this,n=e.diagram,a=e.declaration,r=e.content=[];a&&a.content&&a.content.children&&a.content.children.forEach(function(a){r.push(t.factory(n,a,e))})},get_content:function(){return null==this.content&&this.init_content(),this.content},has_content:function(){return null==this.content&&this.init_content(),this.content.length>0},has_attributes:function(){return this.attributes.length>0},toggle_content:function(){this.content_expanded=!this.content_expanded,this.set_children()},expand_content:function(){this.content_expanded=!0,this.set_children()},toggle_attributes:function(){this.attributes_expanded=!this.attributes_expanded,this.set_children()},expand_attributes:function(){this.attributes_expanded=!0,this.set_children()},expand:function(){this.content_expanded=this.attributes_expanded=!0,this.set_children()},set_children:function(){var t=this.content_expanded,e=this.attributes_expanded;t||e?!t&&e?this.children=this.attributes:t&&!e?this.children=this.get_content():this.children=this.attributes.concat(this.get_content()):this.children=[],this.gs&&(this.gs.select(".cb rect").attr("class",t?"expanded":"collapsed"),this.gs.select(".ab rect").attr("class",e?"expanded":"collapsed"))},compute_width:function(){return this.q_width()+(this.has_content()||this.has_attributes()?a:0)+this.label_width()},draw_enter:function(){var e=this,n=(e.diagram,e.gs),a=t.node_box_height;n.append("rect").attr({"data-id":e.id,"class":"box",width:e.width(),height:a,y:-a/2,rx:6,ry:6}),e.draw_enter_label(),e.draw_enter_q(t.node_text_margin),e.has_content()&&e.draw_button("cb",e.has_attributes()?a/4-.5:0,r.content_click_handler),e.has_attributes()&&e.draw_button("ab",e.has_content()?-a/4+.5:0,r.attributes_click_handler);var i=n.append("g").attr({"class":"button rebase",transform:"translate(2, -16)"});i.append("rect").attr({"class":"collapsed",width:10,height:5,x:0,y:0,rx:2.5,ry:2.5,transform:"translate(0,5)"}).on("click",r.rebase_click_handler)},draw_button:function(e,n,r){var i=this,o=(i.diagram,i.gs),d=t.node_box_height,s=i.width(),c=o.append("g").attr({"class":"button "+e,transform:"translate("+(s-a-2)+","+(n+d/4-16.2)+")"}),l="cb"==e?i.content_expanded:i.attributes_expanded,h=l?"expanded":"collapsed";c.append("rect").attr({"class":h,width:15,height:10,x:0,y:0,rx:5,ry:5,transform:"translate(0,5)"}).on("click",r),"cb"==e?c.append("g").attr("transform","translate(-0.56249982,0)").attr("pointer-events","none").html('<g transform="matrix(0.93056698,0,0,1.2232143,-0.79346636,-1.1542969)">  <path d="m 2.5245,8.71325 6.076,-2.842 0,1.022 -4.97,2.268 4.956,2.268 0.014,1.022 -6.076,-2.842 0,-0.896" /></g><g transform="matrix(-0.93056698,0,0,1.2232143,16.918466,-1.1542969)">  <path d="m 2.5245,8.71325 6.076,-2.842 0,1.022 -4.97,2.268 4.956,2.268 0.014,1.022 -6.076,-2.842 0,-0.896"/></g>'):c.append("path").attr("pointer-events","none").attr("d","m 8.136125,11.77975 c -5.6e-6,-0.07466 0.00466,-0.139997 0.014,-0.196 -0.3546719,0.550669 -0.9006713,0.826002 -1.638,0.826 -0.4480035,2e-6 -0.8120031,-0.149331 -1.092,-0.448 -0.2706692,-0.307997 -0.4060024,-0.704663 -0.406,-1.19 -2.4e-6,-0.8493287 0.3079973,-1.5959946 0.924,-2.24 0.615996,-0.6533266 1.3299953,-0.979993 2.142,-0.98 0.186661,7e-6 0.3919941,0.028007 0.616,0.084 l 0.28,0.07 c 0.037327,0.018674 0.083994,0.028007 0.14,0.028 0.04666,6.9e-6 0.1259933,-0.023326 0.238,-0.07 0.1493264,-0.065326 0.2566596,-0.097993 0.322,-0.098 0.1399928,7e-6 0.2099927,0.060674 0.21,0.182 -7.3e-6,0.028007 -0.00934,0.07934 -0.028,0.154 l -0.07,0.266 -0.798,2.982 c -0.028006,0.112003 -0.042006,0.20067 -0.042,0.266 -6.4e-6,0.168003 0.08866,0.252003 0.266,0.252 0.3453264,3e-6 0.667326,-0.223997 0.966,-0.672 0.419992,-0.625329 0.629992,-1.3486617 0.63,-2.17 -8e-6,-0.7746601 -0.256675,-1.4186595 -0.77,-1.932 -0.504007,-0.5133251 -1.1433397,-0.7699915 -1.918,-0.77 -1.0920045,8.5e-6 -2.0440035,0.4386747 -2.856,1.316 -0.8026686,0.8680063 -1.2040015,1.8900053 -1.204,3.066 -1.5e-6,0.91467 0.2939982,1.680002 0.882,2.296 0.587997,0.606668 1.3253296,0.910001 2.212,0.91 0.5226616,10e-7 0.9519945,-0.06067 1.288,-0.182 0.3453271,-0.130665 0.77466,-0.382665 1.288,-0.756 0.1866593,-0.139998 0.340659,-0.209998 0.462,-0.21 0.177326,2e-6 0.265992,0.084 0.266,0.252 -8e-6,0.177335 -0.121341,0.359335 -0.364,0.546 -0.9240066,0.728001 -1.9413389,1.092 -3.052,1.092 -1.1293367,0 -2.0720024,-0.373333 -2.828,-1.12 -0.7466676,-0.755998 -1.1200005,-1.698664 -1.12,-2.828 -5e-7,-1.3626612 0.503999,-2.5479934 1.512,-3.556 1.0173303,-1.0173247 2.2166624,-1.5259908 3.598,-1.526 1.0453267,9.2e-6 1.894659,0.3080089 2.548,0.924 0.662658,0.6160076 0.993991,1.4186735 0.994,2.408 -9e-6,1.1106714 -0.406009,2.081337 -1.218,2.912 -0.494674,0.504002 -1.0126736,0.756002 -1.554,0.756 -0.2426728,2e-6 -0.4433393,-0.06066 -0.602,-0.182 -0.1586723,-0.121331 -0.2380056,-0.275331 -0.238,-0.462 m 0.294,-1.904 0.378,-1.4 c -0.2800059,-0.1399937 -0.5506723,-0.2099937 -0.812,-0.21 -0.5413382,6.3e-6 -1.0173377,0.2380061 -1.428,0.714 -0.4013369,0.4760051 -0.6020034,1.031338 -0.602,1.666 -3.4e-6,0.644003 0.2799963,0.966003 0.84,0.966 0.7746617,3e-6 1.3159945,-0.578663 1.624,-1.736")},transition_update:function(){this.redraw&&(this.gs.html(""),this.draw_enter(),this.redraw=!1),t.methods.transition_update.call(this)}})}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=21,n=DtdDiagram.AttributeNode=function(){};t.register("attribute",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasLabelNode,{draw_enter:function(){var t=this;t.gs.append("ellipse").attr({"data-id":t.id,"class":"box",cx:t.width()/2,cy:0,rx:t.width()/2,ry:e/2}),t.draw_enter_label()}})}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=DtdDiagram.HasQNode,n=20,a="0,0 "+n/2+","+-n/2+" "+n+",0 "+n/2+","+n/2,r=DtdDiagram.ChoiceNode=function(){};t.register("choice",r),DtdDiagram.extend(r.prototype,t.methods,e,{initialize:function(){var n=this;e.initialize.call(n),(n.spec.children||[]).forEach(function(e){n.children.push(t.factory(n.diagram,e,n.elem_parent))})},width:function(){return n},draw_enter:function(){this.gs.append("polygon").attr({"class":"choice",points:a}),this.draw_enter_q(n/2)}})}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=DtdDiagram.HasQNode,n=t.path,a=t.arc,r=13,i=8,o=n("M",0,i/2,"v",-i)+a(r/2,r,0)+n("v",i)+a(r/2,-r,0)+"z",d=DtdDiagram.SeqNode=function(){};t.register("seq",d),DtdDiagram.extend(d.prototype,t.methods,e,{initialize:function(){var n=this;e.initialize.call(n),(n.spec.children||[]).forEach(function(e){n.children.push(t.factory(n.diagram,e,n.elem_parent))})},width:function(){return r},draw_enter:function(){this.gs.append("path").attr({"class":"seq",d:o}),this.draw_enter_q(r/2)}})}(),"undefined"!=typeof DtdDiagram&&!function(){var t=DtdDiagram.Node,e=18,n=DtdDiagram.OtherNode=function(){};t.register("other",n),DtdDiagram.extend(n.prototype,t.methods,DtdDiagram.HasLabelNode,{draw_enter:function(){var t=this;t.gs.append("g").attr("transform","skewX(-15)").append("rect").attr({"data-id":t.id,"class":"box",width:t.width(),height:e,y:-e/2,rx:3,ry:3}),t.draw_enter_label()}})}(),"undefined"!=typeof DtdDiagram&&!function(){function t(t){var e=t.container_dom,n=t.new_canvas,a=n.width(),r=n.height();t.svg.style({width:a,height:r}),e.style.display="none",e.style.display="block"}function e(t,e){return function(){var n=d3.interpolateNumber(this.scrollTop,t),a=d3.interpolateNumber(this.scrollLeft,e);return function(t){this.scrollTop=n(t),this.scrollLeft=a(t)}}}function n(n){var a=n.new_viewport,r=n.container_dom;return n.embiggenning&&t(n),new_scroll_top=a.top-n.new_canvas.top,new_scroll_left=a.left,new Promise(function(t,a){r.scrollTop!=new_scroll_top||r.scrollLeft!=new_scroll_left?n.container_d3.transition().duration(n.duration).tween("uniquetweenname1",e(new_scroll_top,new_scroll_left)).each("end",function(){t("done scroll_canvas to "+new_scroll_top+", "+new_scroll_left)}):t("scroll_canvas: nothing to do")})}var a=DtdDiagram.Canvas={dropshadow_margin:5};a.scroll_resize=function(t){return r(t),Promise.all([n(t),new Promise(function(e,n){t.svg_g.transition().duration(t.duration).attr({transform:"translate(0, "+-t.new_canvas.top+")"}).each("end",function(){e("done transitioning svg coordinates")})})])},a.finish=function(e){e.embiggenning||t(e)};var r=function(t){var e=DtdDiagram.Box,n=t.root,r=t.min_canvas_height,i=t.min_canvas_width,o=t.src_node,d=t.canvas,s=t.new_drawing=n.tree_extents();s.bottom+=a.dropshadow_margin;var c=s.height()>=r?s.top:(s.bottom+s.top-r)/2,l=s.height()>=r?s.bottom:c+r,h=t.new_canvas=new e(c,s.left,l,s.width()>=i?s.right:s.left+i),u=o.extents(),f=o.tree_extents(),p=f.copy();if(p.width()>i&&(p.right=p.left+i),p.height()>r){var g=p.vcenter(),_=g-r/2,m=g+r/2,D=u.top<_?u.top-_:u.bottom>m?u.bottom-m:0;p.top=_+D,p.bottom=m+D}var v=t.container_dom,w=v.scrollTop,x=v.scrollLeft,y=t.viewport=new e(w+d.top,x,w+d.top+r,x+i),b=t.new_viewport=y.copy();b.vmove(p.top<b.top?p.top-b.top:p.bottom>b.bottom?p.bottom-b.bottom:0),b.vmove(h.top>b.top?h.top-b.top:h.bottom<b.bottom?h.bottom-b.bottom:0),b.hmove(p.left<b.left?p.left-b.left:p.right>b.right?p.right-b.right:0),b.hmove(h.left>b.left?h.left-b.left:h.right<b.right?h.right-b.right:0),t.embiggenning=h.width()>d.width()||h.height()>d.height()}}();